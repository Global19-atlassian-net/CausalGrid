<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tutorial: Beginner • CausalGrid</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Tutorial: Beginner">
<meta property="og:description" content="CausalGrid">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CausalGrid</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/howto_parallel.html">Howto: Parallel Processing</a>
    </li>
    <li>
      <a href="../articles/overview_separate_params.html">Overview: Separate parameter types</a>
    </li>
    <li>
      <a href="../articles/tutorial_beginner.html">Tutorial: Beginner</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/microsoft/CausalGrid/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="tutorial_beginner_files/header-attrs-2.5/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Tutorial: Beginner</h1>
                        <h4 class="author">Brian Quistorff</h4>
            
            <h4 class="date">2021-02-04</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/microsoft/CausalGrid/blob/master/vignettes/tutorial_beginner.Rmd"><code>vignettes/tutorial_beginner.Rmd</code></a></small>
      <div class="hidden name"><code>tutorial_beginner.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://microsoft.github.io/CausalGrid/">CausalGrid</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></code></pre></div>
<p>Some common parameters</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1337</span><span class="op">)</span>
<span class="va">N</span> <span class="op">=</span> <span class="fl">1000</span>
<span class="va">K</span> <span class="op">=</span> <span class="fl">3</span>
<span class="va">err_sd</span> <span class="op">=</span> <span class="fl">1</span></code></pre></div>
<div id="simple-example" class="section level1">
<h1 class="hasAnchor">
<a href="#simple-example" class="anchor"></a>Simple Example</h1>
<p>Let’s get some fake data</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">N</span><span class="op">*</span><span class="va">K</span><span class="op">)</span>, ncol<span class="op">=</span><span class="va">K</span><span class="op">)</span> <span class="co">#Features for splitting partition</span>
<span class="va">d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span> <span class="co">#treatment assignment</span>
<span class="va">tau</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">&gt;</span><span class="fl">.5</span><span class="op">)</span><span class="op">*</span><span class="fl">2</span><span class="op">-</span><span class="fl">1</span> <span class="co">#true treatment effect (just heterogeneous across X1)</span>
<span class="va">y</span> <span class="op">=</span> <span class="va">d</span><span class="op">*</span><span class="va">tau</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="va">err_sd</span><span class="op">)</span> <span class="co">#outcome</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">est_part0</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_estimate_partition.html">fit_estimate_partition</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, <span class="va">d</span>, cv_folds<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="../reference/get_desc_df.html">get_desc_df</a></span><span class="op">(</span><span class="va">est_part0</span><span class="op">)</span>
<span class="co">#&gt;            X1 N_est param_ests         pval</span>
<span class="co">#&gt; 1 &lt;=0.5050542   261 -0.7767593 3.681519e-09</span>
<span class="co">#&gt; 2  &gt;0.5050542   239  0.8697289 3.792252e-11</span></code></pre></div>
<p>We typically want a high-level partition for “human” consumption. To save time, avoid cells with too few observations, and reduce the chance of splitting from running many noisy tests, it’s common to only look for a few splits per dimension. If we don’t specify this, the function will try every possible split across each dimension.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># With just a scalar, we will split at points equal across the quantile-distribution for each feature.</span>
<span class="va">breaks</span> <span class="op">=</span> <span class="fl">5</span> 
<span class="co">#Otherwise we can explicitly list the potential splits to evaluate.</span>
<span class="va">breaks</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">breaks</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">breaks</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>, <span class="va">K</span><span class="op">)</span>
<span class="va">est_part</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_estimate_partition.html">fit_estimate_partition</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, <span class="va">d</span>, breaks_per_dim<span class="op">=</span><span class="va">breaks</span>, cv_folds<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="va">est_part</span><span class="op">)</span></code></pre></div>
<p><img src="tutorial_beginner_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_desc_df.html">get_desc_df</a></span><span class="op">(</span><span class="va">est_part</span><span class="op">)</span>
<span class="co">#&gt;      X1 N_est param_ests         pval</span>
<span class="co">#&gt; 1 &lt;=0.5   255 -0.9035292 3.379837e-12</span>
<span class="co">#&gt; 2  &gt;0.5   245  0.9557823 2.823001e-12</span></code></pre></div>
<p>We can manually estimate this simple model given the partition</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">est_df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">y</span>, d<span class="op">=</span><span class="va">d</span>, f<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">est_part</span><span class="op">$</span><span class="va">partition</span>, <span class="va">X</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="fl">0</span><span class="op">+</span><span class="va">f</span><span class="op">+</span><span class="va">d</span><span class="op">:</span><span class="va">f</span>, data<span class="op">=</span><span class="va">est_df</span><span class="op">[</span><span class="op">-</span><span class="va">est_part</span><span class="op">$</span><span class="va">index_tr</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = y ~ 0 + f + d:f, data = est_df[-est_part$index_tr, </span>
<span class="co">#&gt;     ])</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residuals:</span>
<span class="co">#&gt;     Min      1Q  Median      3Q     Max </span>
<span class="co">#&gt; -3.1360 -0.6908 -0.0019  0.7014  2.6253 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;                               Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">#&gt; f(-1,0.5].(-0.999,2].(-1,2]   -0.09209    0.08434  -1.092    0.275    </span>
<span class="co">#&gt; f(0.5,2].(-0.999,2].(-1,2]     0.05627    0.08786   0.640    0.522    </span>
<span class="co">#&gt; f(-1,0.5].(-0.999,2].(-1,2]:d -0.90353    0.12559  -7.194 2.33e-12 ***</span>
<span class="co">#&gt; f(0.5,2].(-0.999,2].(-1,2]:d   0.95578    0.12769   7.485 3.28e-13 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residual standard error: 0.9979 on 496 degrees of freedom</span>
<span class="co">#&gt; Multiple R-squared:  0.3218, Adjusted R-squared:  0.3164 </span>
<span class="co">#&gt; F-statistic: 58.85 on 4 and 496 DF,  p-value: &lt; 2.2e-16</span></code></pre></div>
<p>Sometimes we want a different level of complexity than that picked by CV. Either we can pre-specify which partition in the sequence that we want (using the <code>partition_i</code> parameter), or we can look at the sequence of objective function values and see where additional splits only provide marginal improvements.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"In-sample Objective function values: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">est_part</span><span class="op">$</span><span class="va">is_obj_val_seq</span>, collapse<span class="op">=</span><span class="st">" "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "In-sample Objective function values:  -0.00130792756957961 -0.860071145786862 -0.906298192191155 -0.974137597678458 -1.01692472825141 -1.05861007636975 -1.1137648149499 -1.16690858898675 -1.22036187891834 -1.23615779557238"</span></code></pre></div>
<p>Compare this with the average treatment effect for the whole and estimation-only samples</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">est_part</span><span class="op">$</span><span class="va">full_stat_df</span>
<span class="co">#&gt;      sample N_est param_ests    var_ests    tstats      ci_u       ci_l</span>
<span class="co">#&gt; N_tr    all  1000 0.03338318 0.005710407 0.4417680 0.1816721 -0.1149057</span>
<span class="co">#&gt; N_es    est   500 0.03350558 0.011765447 0.3088965 0.2466182 -0.1796070</span>
<span class="co">#&gt;           pval</span>
<span class="co">#&gt; N_tr 0.6587528</span>
<span class="co">#&gt; N_es 0.7575295</span></code></pre></div>
<p>We can also manually create partition and estimate it</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_part</span> <span class="op">=</span> <span class="fu"><a href="../reference/partition_from_split_seq.html">partition_from_split_seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/partition_split.html">partition_split</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.4</span><span class="op">)</span>, <span class="fu"><a href="../reference/partition_split.html">partition_split</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>,
                                   <span class="fu"><a href="../reference/get_X_range.html">get_X_range</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span>
<span class="va">cell_stats</span> <span class="op">=</span> <span class="fu"><a href="../reference/est_cell_stats.html">est_cell_stats</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, <span class="va">d</span>, partition<span class="op">=</span><span class="va">my_part</span><span class="op">)</span>
<span class="va">my_est_part</span> <span class="op">=</span> <span class="fu"><a href="../reference/estimated_partition.html">estimated_partition</a></span><span class="op">(</span><span class="va">my_part</span>, <span class="va">cell_stats</span><span class="op">)</span>
<span class="va">my_est_part</span>
<span class="co">#&gt;           X1 N_est param_ests         pval</span>
<span class="co">#&gt; 1      &lt;=0.4   405 -0.8780349 5.306375e-17</span>
<span class="co">#&gt; 2 (0.4, 0.5]   113 -0.9449134 1.136624e-06</span>
<span class="co">#&gt; 3       &gt;0.5   482  0.9632863 1.620334e-25</span></code></pre></div>
<p>How important are each of the dimensions of X for the objective function? We refit the model without each dimension and see the change in the objective function</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">est_part</span><span class="op">$</span><span class="va">importance_weights</span>
<span class="co">#&gt; NULL</span></code></pre></div>
<p>The first feature is the only one that is useful.</p>
<p>Are there any interactions between the importances? (That is if we remove X1, does the importance of X2 change? This is done by dropping pairs of featurs at a time and see how they differ from single-feature droppings)</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">est_part</span><span class="op">$</span><span class="va">interaction_weights</span>
<span class="co">#&gt; NULL</span></code></pre></div>
<p>Essentially no.</p>
<p>Get the observation-level estimated treatment effects.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tau_hat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">est_part</span>, new_X<span class="op">=</span><span class="va">X</span><span class="op">)</span></code></pre></div>
<p>With many estimates, we may wish to account for multiple testing when checking if “there are any negative (or positive) effects”</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">any_neg</span> <span class="op">=</span> <span class="fu"><a href="../reference/test_any_sign_effect.html">test_any_sign_effect</a></span><span class="op">(</span><span class="va">est_part</span>, check_negative<span class="op">=</span><span class="cn">T</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Adjusted 1-side p-values testing if negative:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">any_neg</span><span class="op">$</span><span class="va">pval1s_fdr</span>, collapse<span class="op">=</span><span class="st">", "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "Adjusted 1-side p-values testing if negative: 3.37983707236465e-12, 0.999999999998588"</span></code></pre></div>
<p>Now let’s look at a case where there’s hereogeneity across all three dimensions.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tau_3</span> <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">&gt;</span><span class="fl">0.5</span><span class="op">)</span><span class="op">*</span><span class="fl">2</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">&gt;</span><span class="fl">0.5</span><span class="op">)</span><span class="op">*</span><span class="fl">2</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fl">2</span> <span class="op">+</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">&gt;</span><span class="fl">0.5</span><span class="op">)</span><span class="op">*</span><span class="fl">2</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fl">3</span>
<span class="va">y_3</span> <span class="op">=</span> <span class="va">d</span><span class="op">*</span><span class="va">tau_3</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="va">err_sd</span><span class="op">)</span>
<span class="va">est_part_3</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_estimate_partition.html">fit_estimate_partition</a></span><span class="op">(</span><span class="va">y_3</span>, <span class="va">X</span>, <span class="va">d</span>, breaks_per_dim<span class="op">=</span><span class="fl">5</span>, partition_i<span class="op">=</span><span class="fl">4</span><span class="op">)</span>
<span class="fu"><a href="../reference/get_desc_df.html">get_desc_df</a></span><span class="op">(</span><span class="va">est_part_3</span><span class="op">)</span>
<span class="co">#&gt;            X1          X2          X3 N_est param_ests         pval</span>
<span class="co">#&gt; 1 &lt;=0.4844432 &lt;=0.5158526 &lt;=0.4956977    57 -6.0701075 2.650172e-30</span>
<span class="co">#&gt; 2  &gt;0.4844432 &lt;=0.5158526 &lt;=0.4956977    59 -3.7226053 4.028245e-16</span>
<span class="co">#&gt; 3 &lt;=0.4844432  &gt;0.5158526 &lt;=0.4956977    64 -1.9451039 1.181403e-10</span>
<span class="co">#&gt; 4  &gt;0.4844432  &gt;0.5158526 &lt;=0.4956977    64  0.1690431 5.336151e-01</span>
<span class="co">#&gt; 5 &lt;=0.4844432 &lt;=0.5158526  &gt;0.4956977    63 -0.6908844 3.478647e-02</span>
<span class="co">#&gt; 6  &gt;0.4844432 &lt;=0.5158526  &gt;0.4956977    53  2.3977563 6.423076e-09</span>
<span class="co">#&gt; 7 &lt;=0.4844432  &gt;0.5158526  &gt;0.4956977    72  3.8194994 1.243479e-24</span>
<span class="co">#&gt; 8  &gt;0.4844432  &gt;0.5158526  &gt;0.4956977    68  6.1846918 6.820379e-36</span></code></pre></div>
<p>One benefit of grid-based partitions is that you can view easily view 2D slices of full heterogeneity space.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plts</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="va">est_part_3</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">plts</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">plts</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="tutorial_beginner_files/figure-html/unnamed-chunk-17-1.png" width="576"></p>
</div>
<div id="improving-the-partition" class="section level1">
<h1 class="hasAnchor">
<a href="#improving-the-partition" class="anchor"></a>Improving the partition</h1>
<p>We can improve the partition by controlling for X’s (either local-linearly or global-flexibly) and using bootstrap “bumping”</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">est_part_l</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_estimate_partition.html">fit_estimate_partition</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, <span class="va">d</span>, breaks_per_dim<span class="op">=</span><span class="fl">5</span>, ctrl_method <span class="op">=</span> <span class="st">"LassoCV"</span>, bump_samples <span class="op">=</span> <span class="fl">20</span>, partition_i<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><code>LassoCV</code> is a local-linear approach and we can use the global-flexible approach by setting <code>ctrl_method="RF"</code> for a random forest.</p>
</div>
<div id="mean-outcome-prediction" class="section level1">
<h1 class="hasAnchor">
<a href="#mean-outcome-prediction" class="anchor"></a>Mean-outcome prediction</h1>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">alpha</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">&gt;</span><span class="fl">0.5</span><span class="op">)</span><span class="op">*</span><span class="fl">2</span><span class="op">-</span><span class="fl">1</span> <span class="co">#true average outcome effect (just heterogeneous across X1)</span>
<span class="va">y_y</span> <span class="op">=</span> <span class="va">alpha</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="va">err_sd</span><span class="op">)</span> <span class="co">#outcome</span>
<span class="va">est_part_y</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_estimate_partition.html">fit_estimate_partition</a></span><span class="op">(</span><span class="va">y_y</span>, <span class="va">X</span>, breaks_per_dim<span class="op">=</span><span class="fl">5</span>, partition_i<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="../reference/get_desc_df.html">get_desc_df</a></span><span class="op">(</span><span class="va">est_part_y</span><span class="op">)</span>
<span class="co">#&gt;            X1 N_est param_ests         pval</span>
<span class="co">#&gt; 1 &lt;=0.4844432   249  -1.006088 1.151917e-39</span>
<span class="co">#&gt; 2  &gt;0.4844432   251   1.015044 1.410406e-34</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Brian Quistorff.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
